{"code":"// 实现 new Proxy （target，handler）\r\n// 是不是仅读的，仅读的属性set会报异常\r\nimport { extend, hasChanged, hasOwn, isArray, isIntergerKey, isObject } from \"@vue/shared\";\r\nimport { reactive, readonly } from \"./reactive\";\r\nimport { track, trigger } from \"./effect\";\r\nconst get = createGetter();\r\nconst set = createSetter();\r\nconst shallowGet = createGetter(false, true);\r\nconst shallowSet = createSetter(true);\r\nconst readonlyGet = createGetter(true);\r\nconst shallowReadonlyGet = createGetter(true, true);\r\nexport const mutableHandlers = {\r\n    get,\r\n    set,\r\n};\r\nexport const shallowReactiveHandlers = {\r\n    get: shallowGet,\r\n    set: shallowSet,\r\n};\r\nlet readonlyObj = {\r\n    set: (target, key) => {\r\n        console.warn(`set on key ${key} failed`);\r\n    },\r\n};\r\nexport const readonlyHandlers = extend({\r\n    get: readonlyGet,\r\n}, readonlyObj);\r\nexport const shallowReadonlyHandlers = extend({\r\n    get: shallowReadonlyGet,\r\n}, readonlyObj);\r\n// 是不是仅读的 是不是仅读的属性 set 时会报异常\r\n// 是不是深度的\r\n// 拦截获取\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    return function get(target, key, receiver) {\r\n        // 后续Object上的方法 会被迁移到Reflect Reflect.getProptypeof\r\n        // 以前target[key] =value 方式设置值可能失败，并不会报异常，也没有返回的标识\r\n        // Reflect 方法具备返回值\r\n        const res = Reflect.get(target, key, receiver);\r\n        if (!isReadonly) {\r\n            // 收集依赖，数据变化后更新对应的视图\r\n            console.log(\"执行effect时会取值\", \"收集effect\");\r\n            console.log(key, \"key\");\r\n            track(target, 0 /* TrackOpTypes.GET */, key);\r\n        }\r\n        if (shallow) {\r\n            return res;\r\n        }\r\n        if (isObject(res)) {\r\n            // vue2 是一上来就递归 vue3是当取值时会进行代理，vue3的代理模式是懒代理\r\n            return isReadonly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nfunction createSetter(shallow = false) {\r\n    return function set(target, key, value, receiver) {\r\n        const oldValue = target[key];\r\n        let hadKey = isArray(target) && isIntergerKey(key) ? Number(key) < target.length : hasOwn(target, key);\r\n        const result = Reflect.set(target, key, value, receiver);\r\n        if (!hadKey) {\r\n            trigger(target, 0 /* TriggerOrTypes.ADD */, key, value);\r\n        }\r\n        else if (hasChanged(oldValue, value)) {\r\n            trigger(target, 1 /* TriggerOrTypes.SET */, key, value, oldValue);\r\n        }\r\n        // 区分新增和修改 vue2无法监控更改索引，无法监控数组的长度\r\n        // 当数据更新是 通知对应的属性effect重新执行\r\n    };\r\n}\r\n//# sourceMappingURL=baseHandlers.js.map","references":["D:/学习/学习计划/Study-Vue3/vue3/packages/shared/src/index.ts","D:/学习/学习计划/Study-Vue3/vue3/packages/reactivity/src/reactive.ts","D:/学习/学习计划/Study-Vue3/vue3/packages/reactivity/src/operators.ts","D:/学习/学习计划/Study-Vue3/vue3/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"baseHandlers.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/baseHandlers.ts\"],\"names\":[],\"mappings\":\"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\"}"}
